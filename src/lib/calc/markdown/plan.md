# Simulation Engine Plan

## Portfolio

- Total value, total contributions (amount and %), total withdrawals (amount and %)
- Account-level: value, asset allocation, contributions (amount and %), withdrawals (amount and %)
- Handle contribution limits per account type

## Phase

- Phase type: accumulation, retirement, bankrupt

## Returns

- Portfolio-level: stocks, bonds, cash (rate and amount), inflation rate
- Account-level: weighted return rate and amount

## Income

- Total: gross amount, withholding, after-withholding amount
- Per source: gross amount, withholding, after-withholding amount
- Growth since last period (?)

## Expenses

- Total expenses
- Amount per expense category
- Growth since last period (?)

## Taxes

- Dividends: qualified (taxed at capital gains rate), non-qualified (taxed as income)
- Realized capital gains from taxable account withdrawals
- Income tax on tax-deferred withdrawals
- Federal income tax (progressive rates based on filing status)
- Net Investment Income Tax (NIIT)
- [P2] Social Security tax on benefits
- [P2] Property tax
- [P2] State and city income tax

## Penalties

- Early withdrawal penalties: Roth, 401(k), IRA, HSA
- Required Minimum Distribution (RMD) penalties

## Fees

- IRMAA surcharges
- Medicare premiums
- ACA subsidies (negative fee)

## Strategies

- Roth conversions (reduce future RMDs)
- RMDs on tax-deferred accounts
- Basis step-up harvesting in taxable accounts
- Rule of 55
- 72(t) / SEPP distributions
- Roth conversion ladder
- Tax loss harvesting
- HSA receipt saving strategy
- Asset location optimization (tax-inefficient in tax-advantaged)
- Qualified dividends and LTCG in taxable accounts
- Social Security claiming optimization
- Better drawdown order
